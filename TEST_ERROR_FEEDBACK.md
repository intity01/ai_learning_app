# 🧪 คู่มือทดสอบ Error Feedback System

## ✅ สิ่งที่แก้ไขแล้ว

1. **เพิ่ม `_hasShownExplanation` state** - ป้องกันการแสดง dialog ซ้ำ
2. **ปรับปรุงปุ่ม** - เปลี่ยนเป็น "เข้าใจแล้ว ไปต่อเลย" หลังจากแสดง dialog แล้ว
3. **Logic ที่ถูกต้อง** - เมื่อตอบผิด dialog จะแสดงทันที และปุ่มจะเปลี่ยนเป็น "เข้าใจแล้ว ไปต่อเลย"

---

## 🎯 วิธีทดสอบ

### **ขั้นตอนที่ 1: เปิดแอปและเข้าไปที่บทเรียน**

1. รันแอป:
```bash
flutter run -d emulator-5554
```

2. ไปที่หน้า **"บทเรียน"** (Lesson List)
3. เลือก **"บทที่ 1"** (หรือบทเรียนใดก็ได้)

---

### **ขั้นตอนที่ 2: ทดสอบ Error Feedback**

#### **Test Case 1: ตอบผิด → ดู Explanation**

1. **อ่านคำถาม** - เช่น "คำว่า 'สวัสดี' ภาษาญี่ปุ่นคือ?"
2. **เลือกคำตอบผิด** - เช่น เลือก "Sayonara" (ผิด)
3. **กดปุ่ม "ตรวจคำตอบ"**
4. **ผลลัพธ์ที่คาดหวัง:**
   - ✅ คำตอบที่เลือก (Sayonara) จะเป็นสีแดง + มี icon ❌
   - ✅ คำตอบที่ถูกต้อง (Konnichiwa) จะเป็นสีเขียว + มี icon ✓
   - ✅ **Modal Bottom Sheet จะแสดงขึ้นมาทันที** พร้อม:
     - Header: "คำตอบไม่ถูกต้อง" (สีแดง)
     - คำตอบที่ถูกต้อง: "Konnichiwa" (สีเขียว)
     - คำอธิบาย: "Konnichiwa (こんにちは) แปลว่า 'สวัสดี' ใช้ทักทายตอนกลางวัน..."
   - ✅ ปุ่มด้านล่างจะเปลี่ยนเป็น **"ดูคำอธิบาย"** (สีแดง)

5. **กดปุ่ม "เข้าใจแล้ว ไปต่อเลย"** ใน Modal
6. **ผลลัพธ์:**
   - ✅ Modal จะปิด
   - ✅ ไปข้อถัดไปอัตโนมัติ

---

#### **Test Case 2: ตอบถูก → ไปต่อเลย**

1. **เลือกคำตอบที่ถูกต้อง** - เช่น เลือก "Konnichiwa"
2. **กดปุ่ม "ตรวจคำตอบ"**
3. **ผลลัพธ์ที่คาดหวัง:**
   - ✅ คำตอบที่เลือกจะเป็นสีเขียว + มี icon ✓
   - ✅ **ไม่มี Modal แสดง** (เพราะตอบถูก)
   - ✅ ปุ่มจะเปลี่ยนเป็น **"ไปต่อเลย"** (สีเขียว)

4. **กดปุ่ม "ไปต่อเลย"**
5. **ผลลัพธ์:**
   - ✅ ไปข้อถัดไปอัตโนมัติ

---

#### **Test Case 3: ป้องกันการแสดง Dialog ซ้ำ**

1. **ตอบผิด** และ **Modal แสดงขึ้นมา**
2. **กดปุ่ม "เข้าใจแล้ว ไปต่อเลย"** ใน Modal
3. **ผลลัพธ์:**
   - ✅ Modal ปิด
   - ✅ ไปข้อถัดไป
   - ✅ **ไม่มีการแสดง Modal ซ้ำ**

---

## 📋 Checklist การทดสอบ

### ✅ UI/UX
- [ ] Modal Bottom Sheet แสดงขึ้นมาทันทีเมื่อตอบผิด
- [ ] Modal มี Header สีแดง "คำตอบไม่ถูกต้อง"
- [ ] Modal แสดงคำตอบที่ถูกต้อง (สีเขียว)
- [ ] Modal แสดงคำอธิบาย (สีฟ้า)
- [ ] Modal มีปุ่ม "เข้าใจแล้ว ไปต่อเลย"
- [ ] คำตอบที่เลือกผิดเป็นสีแดง + icon ❌
- [ ] คำตอบที่ถูกต้องเป็นสีเขียว + icon ✓
- [ ] ปุ่มด้านล่างเปลี่ยนเป็น "ดูคำอธิบาย" เมื่อตอบผิด
- [ ] ปุ่มด้านล่างเปลี่ยนเป็น "เข้าใจแล้ว ไปต่อเลย" หลังจากแสดง dialog แล้ว

### ✅ Functionality
- [ ] ตอบผิด → Modal แสดงทันที
- [ ] ตอบถูก → ไม่มี Modal
- [ ] กด "เข้าใจแล้ว ไปต่อเลย" → ไปข้อถัดไป
- [ ] ไม่มีการแสดง Modal ซ้ำ
- [ ] ข้อถัดไป reset state ถูกต้อง

### ✅ Edge Cases
- [ ] ตอบผิด → แสดง Modal → กด "เข้าใจแล้ว ไปต่อเลย" → ไปข้อถัดไป
- [ ] ตอบผิด → แสดง Modal → กดปุ่มด้านล่าง "เข้าใจแล้ว ไปต่อเลย" → ไปข้อถัดไป
- [ ] ตอบถูก → กด "ไปต่อเลย" → ไปข้อถัดไป
- [ ] ข้อสุดท้าย → จบบทเรียน → แสดง Dialog "บทเรียนสำเร็จ!"

---

## 🐛 ปัญหาที่อาจพบ

### **ปัญหา: Modal ไม่แสดง**
- **สาเหตุ:** `_hasShownExplanation` ยังเป็น `true`
- **แก้ไข:** ตรวจสอบว่า `_nextQuestion()` รีเซ็ต state ถูกต้อง

### **ปัญหา: Modal แสดงซ้ำ**
- **สาเหตุ:** ไม่มี `_hasShownExplanation` check
- **แก้ไข:** ตรวจสอบว่า `_showExplanationDialog()` มี `if (_hasShownExplanation) return;`

### **ปัญหา: ปุ่มไม่เปลี่ยน**
- **สาเหตุ:** Logic ใน `onPressed` ไม่ถูกต้อง
- **แก้ไข:** ตรวจสอบว่า `_hasShownExplanation` ถูกใช้ใน condition

---

## 🎨 UI Elements ที่ควรเห็น

### **เมื่อตอบผิด:**
```
┌─────────────────────────────────┐
│  ❌ คำตอบไม่ถูกต้อง              │
│  มาดูคำอธิบายกัน                 │
├─────────────────────────────────┤
│  ✓ คำตอบที่ถูกต้อง:              │
│  Konnichiwa                     │
├─────────────────────────────────┤
│  💡 คำอธิบาย:                    │
│  Konnichiwa (こんにちは) ...     │
├─────────────────────────────────┤
│  [เข้าใจแล้ว ไปต่อเลย]           │
└─────────────────────────────────┘
```

### **เมื่อตอบถูก:**
```
┌─────────────────────────────────┐
│  ✓ Konnichiwa                   │
├─────────────────────────────────┤
│  [ไปต่อเลย]                      │
└─────────────────────────────────┘
```

---

## 🚀 วิธีรันแอป

### **Option 1: ใช้ Android Emulator**
```bash
# เปิด Emulator
flutter emulators --launch pixel_6_-_api_34_naphat

# รันแอป
flutter run -d emulator-5554
```

### **Option 2: ใช้ Script**
```bash
# Windows PowerShell
.\run_android.ps1

# หรือ Batch
.\start_emulator.bat
```

---

## 📝 หมายเหตุ

- **Modal ไม่สามารถปิดได้โดยการ swipe down** (เพราะ `isDismissible: false`)
- **ต้องกดปุ่ม "เข้าใจแล้ว ไปต่อเลย"** เพื่อปิด Modal
- **ทุกคำถามมี `explanation`** ใน `lib/lesson_data.dart`

---

**พร้อมทดสอบแล้ว! 🎉**


